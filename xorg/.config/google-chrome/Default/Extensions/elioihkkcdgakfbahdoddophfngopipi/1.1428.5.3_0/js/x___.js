// "Photo Zoom for Facebook" v1.1408.5.2
// Everything is (c) Copyright by Regis Gaughan, III <regis.gaughan@gmail.com>.
// All rights reserved.

!function(a){var b={},c=+new Date;b.uniqueID=function(){return(c++).toString(36)};var d,e=[];b.onLoad=function(a){if("complete"===document.readyState)a();else{e.push(a),d&&clearTimeout(d);var b=function(){if("complete"===document.readyState)for(var a=0,c=e.length;c>a;a++)e[a]();else d=setTimeout(b,10)};d=setTimeout(b,10)}},b.createElement=function(b,c,d){d=d||a.document;var e=d.createElement(b);return c&&this.setProperties(e,c),e},b.setProperties=function(a,c){for(var d in c)b.setProperty(a,d,c[d])},b.setProperty=function(a,c,d){return"style"!=c&&"styles"!=c||"object"!=typeof d?("html"==c?c="innerHTML":"text"==c&&(c="textContent"),a["class"==c?"className":c]=d,a):b.setStyles(a,d)},b.addClass=function(a,c){b.removeClass(a,c),a.className+=" "+c},b.removeClass=function(a,b){a.className=a.className.replace(new RegExp("(^|\\s)"+b+"(?:\\s|$)"),"$1")},b.camelCase=function(a){return a.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},b.setStyles=function(a,b){for(var c in b)this.setStyle(a,c,b[c]);return a},b.setStyle=function(a,b,c){if("opacity"==b)void 0!==a.style.opacity?a.style.opacity=c:void 0!==a.style.MozOpacity?a.style.MozOpacity=c:void 0!==a.style.msFilter?a.style.msFilter="progid:DXImageTransform.Microsoft.Alpha(Opacity="+100*c+")":void 0!==a.style.filter&&(a.style.filter="alpha(opacity="+100*c+")");else{if("box-shadow"==b)return this.setStyle(a,"-moz-box-shadow",c),this.setStyle(a,"-webkit-box-shadow",c),a.style[this.camelCase(b)]=c,a;"float"==b&&(b="cssFloat"),a.style[this.camelCase(b)]=c}return a},b.getEvent=function(b){return b?b:b=a.event},b.preventEventDefault=function(a){return a=this.getEvent(a),a&&(a.preventDefault?a.preventDefault():a.returnValue=!1),!1},b.getEventTarget=function(b){var c;return b=b||a.event,b.target?c=b.target:b.srcElement&&(c=b.srcElement),3==c.nodeType&&(c=c.parentNode),c},b.merge=function(a){var b,c,d,e;for(b=1,c=arguments.length;c>b;b++){d=arguments[b];for(e in d)d.hasOwnProperty(e)&&(a[e]=d[e])}return a},b.setOptions=function(a,b){var c={};b=b||{};for(var d in a)a.hasOwnProperty(d)&&(c[d]="undefined"!=typeof b[d]?b[d]:a[d]);return c},b.toQueryString=function(a){a=a||{};var b="?";for(var c in a)b+=c+"="+a[c]+"&";return b.replace(/\&$/,"")},a.util=b}(this),function(a){var b,c;c=chrome.storage.local,b=a.proxy={getExtDetails:function(a){chrome.extension.sendRequest({name:"getExtDetails"},a)},setCurrentImageUrl:function(a){chrome.extension.sendRequest({name:"setCurrentImageUrl",value:a})},setEnabled:function(a){c.set({enabled:!!a})},log:function(){},openImage:function(){}},b.storage={get:function(){c.get.apply(c,arguments)},set:function(){c.set.apply(c,arguments)},addListener:function(a){chrome.storage.onChanged.addListener(a)}}}(this),function(a){"use strict";var b=a.util,c=a.proxy,d=a.PhotoTip=function(){return this.init.apply(this,arguments)};d.prototype={defaults:{moveDelay:10,padding:5,offset:10,gutter:20,opacity:1,delay:50,fadeInDuration:150,fadeOutDuration:150},init:function(c){var d;d=this,d.setOptions(c),d._uid="_"+b.uniqueID();var e="";return e+="#"+d._uid+" {padding:"+d.options.padding+"px; position:absolute; overflow:hidden; font-size:0; box-shadow:0px 1px 10px rgba(0,0,0,1); min-height:50px; min-width:50px; pointer-events:none; background:#FFF; z-index:99999; opacity:0;}",e+="#"+d._uid+" {background:#FFF url(data:image/gif;base64,R0lGODlhEAALALMMAOXp8a2503CHtOrt9L3G2+Dl7vL0+J6sy4yew1Jvp/T2+e/y9v///wAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFCwAMACwAAAAAEAALAAAEK5DJSau91KxlpObepinKIi2kyaAlq7pnCq9p3NZ0aW/47H4dBjAEwhiPlAgAIfkECQsADAAsAAAAAAQACwAABA9QpCQRmhbflPnu4HdJVAQAIfkECQsADAAsAAAAABAACwAABDKQySlSEnOGc4JMCJJk0kEQxxeOpImqIsm4KQPG7VnfbEbDvcnPtpINebJNByiTVS6yCAAh+QQJCwAMACwAAAAAEAALAAAEPpDJSaVISVQWzglSgiAJUBSAdBDEEY5JMQyFyrqMSMq03b67WY2x+uVgvGERp4sJfUyYCQUFJjadj3WzuWQiACH5BAkLAAwALAAAAAAQAAsAAAQ9kMlJq73hnGDWMhJQFIB0EMSxKMoiFcNQmKjKugws0+navrEZ49S7AXfDmg+nExIPnU9oVEqmLpXMBouNAAAh+QQFCwAMACwAAAAAEAALAAAEM5DJSau91KxlpOYSUBTAoiiLZKJSMQzFmjJy+8bnXDMuvO89HIuWs8E+HQYyNAJgntBKBAAh+QQFFAAMACwMAAIABAAHAAAEDNCsJZWaFt+V+ZVUBAA7) no-repeat center center;}",e+="#"+d._uid+" {-moz-transition:opacity 0s ease-in-out; -webkit-transition:opacity 0s ease-in-out; transition:opacity 0s ease-in-out;}",e+="#"+d._uid+' * {color:#333 !important; font-size:11px !important; font-family:"lucida grande",tahoma,verdana,arial,sans-serif !important;}',e+="."+d._uid+"-waitingroom {height:0px; width:0px; position:absolute; top:-10px; left:-10px; overflow:hidden; visibility:hidden;}",document.head.appendChild(b.createElement("style",{type:"text/css",text:e})),d.element=b.createElement("section",{id:d._uid}),d.elements={},d.elements.img=null,d.elements.info=b.createElement("section",{}),d.element.appendChild(d.elements.info),document.body.appendChild(d.element),d.elements.waitingroom=b.createElement("section",{"class":d._uid+"-waitingroom"}),document.body.appendChild(d.elements.waitingroom),d._lastMouseMove=0,document.body.addEventListener("mousemove",d.onMouseMove.bind(d),!1),"ontransitionend"in a&&d.element.addEventListener("transitionend",d.onElementTransitionEnd.bind(d),!1),d},setOptions:function(a){var c;return c=this,c.options=b.setOptions(c.options||c.defaults,a),c},set:function(a,b){var c,d;return c=this,c.unset(),c._currentSrc=a,d=c.newImage(a,b),"loaded"===d.getAttribute("loaded")&&c.setTooltipImg(d),c},unset:function(){var a;a=this,a.elements.img&&a.elements.waitingroom.appendChild(a.elements.img),a.elements.img=null,a._currentSrc=null,a._shown=!1,a.position.bind(a),a.element.style.display="none"},newImage:function(a,c){var d,e;return d=this,e=d.checkWaitingRoom(a),e||(e=b.createElement("img",{title:c||null}),d.elements.waitingroom.appendChild(e),e.addEventListener("load",d.onImgComplete.bind(d)),e.addEventListener("error",d.onImgComplete.bind(d)),e.src=a),e},onImgComplete:function(a){var d,e;d=this,e=b.getEventTarget(a),"load"===a.type?(c.log("info","Photo Loaded.",{src:e.src}),e.setAttribute("loaded","loaded"),d.setTooltipImg(e)):(c.log("error","Photo Error",{src:e.src}),d.hide())},setTooltipImg:function(a){var b;b=this,a.parentNode===b.elements.waitingroom&&0===(b._currentSrc||[]).indexOf(a.src)&&(!a.naturalWidth||a.naturalWidth<=0?(b.elements.waitingroom.removeChild(a),b.newImage(a.src+"?force="+(new Date).getTime(),this.tooltipImg.title)):"avoid"===a.getAttribute("avoid")||a.naturalWidth<24&&a.naturalHeight<24?(a.setAttribute("avoid","avoid"),setTimeout(b.hide.bind(b),0)):(b.elements.img=a,b.element.appendChild(b.elements.img),b.position()))},checkWaitingRoom:function(a){return this.elements.waitingroom.querySelector('img[src^="'+a+'"]')||this.elements.img&&this.elements.img===a&&this.elements.img||null},show:function(){var a,c;return a=this,a._showInterval&&clearTimeout(a._showInterval),a._showInterval=setTimeout(function(){a._shown=!0,a.element.style.display="block",c=a.options.fadeInDuration/1e3+"s",setTimeout(function(){b.setStyles(a.element,{MozTransitionDuration:c,WebkitTransitionDuration:c,TransitionDuration:c,opacity:a.options.opacity})},1),a.position()},a.isShown()?0:a.options.delay),a},hide:function(){var a,c;return a=this,a._showInterval&&clearTimeout(a._showInterval),c=a.options.fadeOutDuration/1e3+"s",b.setStyles(a.element,{MozTransitionDuration:c,WebkitTransitionDuration:c,TransitionDuration:c,opacity:0}),a},isShown:function(){return!!this._shown},isImgLoaded:function(){var a;return a=this,a.elements.img&&"loaded"===a.elements.img.getAttribute("loaded")},position:function(){var c,d,e,f,g,h,i,j,k;return c=this,d=c.mouse,c.isShown()&&d?(e={x:a.scrollX,y:a.scrollY},h=d.y+e.y-c.element.offsetHeight/2,i=d.x+e.x+c.options.offset,c.isImgLoaded()&&(f={x:document.body.clientWidth,y:document.body.clientHeight},g={x:c.elements.img.naturalWidth,y:c.elements.img.naturalHeight},j=d.x+c.options.offset+(g.x+2*c.options.padding)<f.x-c.options.gutter,j||(k=d.x-c.options.offset-(g.x+2*c.options.padding)>c.options.gutter),(j||k)&&b.setStyles(c.elements.img,{width:"auto",height:"auto"}),!j&&k?i=d.x+e.x-c.options.offset-(g.x+2*c.options.padding):j||k||(d.x<=f.x/2?b.setStyles(c.elements.img,{width:f.x-(d.x+c.options.offset+2*c.options.padding+c.options.gutter)+"px",height:"auto"}):(i=e.x+c.options.gutter,b.setStyles(c.elements.img,{width:d.x-c.options.offset-2*c.options.padding-c.options.gutter+"px",height:"auto"}))),h>a.innerHeight+e.y-c.element.offsetHeight-c.options.gutter&&(h=a.innerHeight+e.y-c.element.offsetHeight-c.options.gutter),h<e.y+c.options.gutter&&(h=e.y+c.options.gutter,c.element.offsetHeight>a.innerHeight-2*c.options.gutter&&(b.setStyles(c.elements.img,{height:a.innerHeight-2*c.options.padding-2*c.options.gutter+"px",width:"auto"}),j=d.x+c.options.offset+c.element.offsetWidth<f.x-c.options.gutter,i=j?d.x+e.x+c.options.offset:d.x+e.x-c.element.offsetWidth-c.options.offset))),b.setStyles(c.element,{top:parseInt(h,10)+"px",left:parseInt(i,10)+"px"}),c):c},onMouseMove:function(a){var b,c;b=this,c=+new Date,c>b._lastMouseMove+b.options.moveDelay&&(b._lastMouseMove=c,b.mouse={x:a.clientX,y:a.clientY},b.isShown()&&b.position())},onElementTransitionEnd:function(a){var b;b=this,a.srcElement===b.element&&"opacity"===a.propertyName&&"0"===b.element.style.opacity&&b.unset()}}}(this),function(a){"use strict";var b=a.util,c=a.proxy,d=a.PhotoTip,e=a.PhotoZoom=function(a){return this.init(a)};e.prototype={defaults:{moveDelay:10,name:"Photo Zoom for Facebook",version:null,id:null,enabled:!0,showCaptions:!0,disableTheater:!1,enableShortcut:90,openShortcut:88,forceZoomKey:-1,forceHideKey:-1},init:function(a){var c;c=this,c.setOptions(a),c._uid="_"+b.uniqueID(),c.name=c.options.name,c.current=null,c.phototip=new d(a),c.elements={},c.icons={on:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8%2F9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAXFJREFUeNpi%2FP%2F%2FPwMymDJlyv9Xr14xEAPExMQYWI6cf4ostgOkuaioiEFAQACv5g8fPjD09fUxsGCTBGnObNiE14DpDX5gmgnZdmwKmZgYGcK9dBnKU20Z%2BHjYMeUJ%2BdNAQ5LBwUyRQUFakMFcXxanATtwGcDDzQZn83Kxke6CD59%2BwNnvPn7HasAOfAZcuf2S4c%2Fff2D2hRvPMeRZbl8%2BZPT%2B%2FXusmrk52RjcbVQYWJghDg1w1mJYt%2Fsqw6cvPxEGgDRHhIcz8PDwggV6ulrANCjggly1GFhZmeGKzfVlGIx1pBh2HLqNMAAcUEDNPfOPMHBxsMITCSjqsAGQa3wc1cFq4AbAgJOFEsOpn2LgFEZ0UkYW%2BP7jN4OJbcDrbYduMZQk2jDMmTuHwczO%2FxwuA2wMpT3gBihICTAoyggCUx4Tg6q8MCHLPVDC4MuXzwwh7jpwWX8nTbAYPo1wAwQFBRlWrFyJ1RqQHC6NMAAQYADaHmfCJgAfvAAAAABJRU5ErkJggg%3D%3D",off:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8%2F9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAZdJREFUeNpi%2Bf%2F%2FPwMymDJlyv9Xr14xEAPExMQYWI6cf4ostgOkuaioiEFAQACv5g8fPjD09fUxsGCTBGnObNiE14DpDX5gmgnZdmwKmZgYGcK9dBnKU20Z%2BHjYMeUJ%2BdNAQ5LBwUyRQUFakMFcXxanATtwGcDDzQZn83Kxke6CD59%2BwNnvPn7HasAOfAZcuf2S4c%2Fff2D2hRvPMeRZbl8%2BZPT%2B%2FXusmrk52RjcbVQYWJghDg1w1mJYt%2Fsqw6cvPxGKeidMffX0%2BZtXHz%2F%2FBOPa2tr%2FILBi66X%2Fv379%2BY8Mjjg5%2Fd%2FAwADHixUU%2FoPTAQ8PL0PP%2FCMMXBys8EQCijp08GbfPgZ%2FYMrdyMgIp1ESkpOFEsOpn2LgFIYNGAMxsmZwGCAr%2BP7jN4OJbcDrbYduMZQk2jDMmTuHwczO%2FxxM%2Fm1zsztOFyhICTAoyggCUx4Tg6q8MFYXsOgavQFqEmGAugQUg2ADvnz5zBDirgNX6O%2BkCRZDB38unxPFMFRQUJBhxcqVWG0EyYGAjaG0B5iBlvVBACDAAHFtphFIakqbAAAAAElFTkSuQmCC"},c.createAppIcon();var e="";e+="."+c._uid+"-title:empty {bottom:-20px; height:0px; min-height:0px; -moz-transition:bottom 0s ease-in-out; -webkit-transition:bottom 0s ease-in-out; transition:bottom 0s ease-in-out;}",e+="."+c._uid+"-title {-moz-transition:bottom 0.33s ease-in-out; -webkit-transition:bottom 0.33s ease-in-out; transition:bottom 0.33s ease-in-out;}",e+="."+c._uid+"-title {position:absolute; z-index:3; padding:4px 5px 5px; bottom:0px; left:0px; width:100%; background:#FFF; color:#000; font:bold 11px helvetica,arial,sans-serif; -moz-box-sizing:border-box; -webkit-box-sizing:border-box; box-sizing:border-box; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}",e+="."+c._uid+"-tooltip."+c._uid+"-hide-tooltip ."+c._uid+"-title {bottom:-20px !important;}",e+="."+c._uid+"-icon {cursor:pointer; color:transparent !important; text-decoration:none !important; position:absolute !important; top:auto; left:-35px; right:auto; bottom:0px; padding:0px; z-index:300;}",e+=".fbDockWrapperLeft ."+c._uid+"-icon {left:auto !important; right:-35px !important;}",e+="body > ."+c._uid+"-icon {position:fixed !important; right:25px !important; left:auto !important;}",e+="."+c._uid+"-icon {background:#EBEEF4; border:1px solid #BDBFC4; border-bottom:0px; -webkit-background-clip:padding-box; -moz-background-clip:padding-box; -webkit-box-shadow:0 1px 1px rgba(0,0,0,.3), inset 0 1px rgba(255,255,255,.5); -moz-box-shadow:0 1px 1px rgba(0,0,0,.3), inset 0 1px rgba(255,255,255,.5); box-shadow:0 1px 1px rgba(0,0,0,.3), inset 0 1px rgba(255,255,255,.5);  -webkit-border-top-left-radius: 1px 1px; -webkit-border-top-right-radius: 1px 1px;}",e+="."+c._uid+"-icon:hover {cursor:pointer; background:#F5F7FA text-decoration:none !important;}",e+="."+c._uid+"-icon *, ."+c._uid+"-icon:hover * {text-decoration:none !important;}",e+="."+c._uid+"-icon > i {pointer-events:none; display:block; width:27px; height:24px; background:transparent none no-repeat center center;}",e+="."+c._uid+"-icon ."+c._uid+"-titletip {display:none; position:absolute; color:#FFF !important; right:6px; bottom:27px; z-index:20; padding-bottom:4px; background:transparent url(data:image/gif;base64,R0lGODlhEwAEAIABACgoKAAAACH5BAEAAAEALAAAAAATAAQAAAINjA+pcO2x2Jsw0StnAQA7) no-repeat right bottom;}",e+="."+c._uid+"-icon ."+c._uid+"-titletip strong {display:block; *margin:0; padding:3px 8px; text-align:center; white-space:nowrap; font-weight:normal; color:#fff; background:#282828;}",e+="."+c._uid+"-icon:hover ."+c._uid+"-titletip {display:block !important;}",e+=".friendListing .friendName {pointer-events:none;}",e+='[class*="mage"]:after, [class*="hoto"]:after {pointer-events:none !important;}',e+='[href*="photo.php"]:after {pointer-events:none !important;;}',e+=".uiScaledImageContainer + div[class] {pointer-events:none !important;}",e+="*:after {pointer-events:none !important;;}",document.head.appendChild(b.createElement("style",{type:"text/css",text:e})),c._lastMouseMove=0,document.addEventListener("keydown",c.onKeyDown.bind(c),!1),document.addEventListener("keyup",c.onKeyUp.bind(c),!1),document.body.addEventListener("mousemove",c.onMouseMove.bind(c),!1),document.body.addEventListener("mousewheel",c.onMouseMove.bind(c),!1),document.body.addEventListener("drag",c.onMouseDrag.bind(c),!1),document.body.addEventListener("dragstart",c.onMouseDown.bind(c),!1),document.body.addEventListener("dragend",c.onMouseUp.bind(c),!1),document.body.addEventListener("mousedown",c.onMouseDown.bind(c),!1),document.body.addEventListener("mouseup",c.onMouseUp.bind(c),!1),document.body.addEventListener("click",c.onBodyClick.bind(c),!1)},setOptions:function(a){var c;return c=this,c.options=b.setOptions(c.options||c.defaults,a),c.onMouseMove(),c.updateAppIcon(),c},toggle:function(){var a;return a=this,a.options.enabled=!a.options.enabled,a.onMouseMove(),a.updateAppIcon(),c.setEnabled(this.options.enabled),c.log("info","Toggled",this.options.enabled),a},show:function(a){var b;return b=this,b.current=a,b.phototip.set(b.current.zoomed).show(),c.setCurrentImageUrl(b.current.zoomed),b},hide:function(){var a;return a=this,a.current=null,a.phototip.hide(),c.setCurrentImageUrl(null),a},getZoomedPath:function(a,b){var c,d=null;return(c=/^.*?app_full_proxy\.php\?.*?src\=([^\&]+).*$/i).test(a)?d=decodeURIComponent(a.replace(c,"$1")):(c=/^.*?safe_image\.php\?.*?url\=([^\&]+).*$/i).test(a)?d=decodeURIComponent(a.replace(c,"$1")):(c=new RegExp("_[aqst"+(b?"n":"")+"]\\.(jpe?g)$","i")).test(a)?d=a.replace(c,"_n.$1"):(c=new RegExp("[aqst"+(b?"n":"")+"]([\\d_]+)\\.(jpe?g)$","i")).test(a)&&(d=a.replace(c,"n$1.$2")),d=d||a,(c=/\/[a-z]\d+x\d+\//i).test(d)&&(d=d.replace(c,"/")),(c=/\/[a-z]\d+(\.\d+){3}\//i).test(d)&&(d=d.replace(c,"/")),(c=/^(https?:\/\/[^\/]*flickr.com\/.*)_[tsm](\.jpe?g)$/i).test(d)&&(d=d.replace(c,"$1$2")),d&&d.replace(/(^['"])|(['"]$)/g,"")},getZoomableTarget:function(b){var c,d,e,f,g,h;if(c=this,e=null,d=b.localName.toLowerCase(),"img"===d&&b.src.indexOf("fbcdn-profile")>-1){var i,j,k;k=b.parentElement,j=/^https?:\/\/[^\/]*?facebook\.[^\/]*?\/([^\/\?]+).*$/gi;do if("A"===k.nodeName&&k.href){i=k.href.replace(j,"$1"),-1===i.indexOf(".php")&&(e=g="https://graph.facebook.com/"+i+"/picture?width=9999999999");break}while(k=k.parentNode);f=""}return null===e&&("img"!==d||!b.src||/spotlight/i.test(b.className)||/fbPhotoImage/i.test(b.id)||/coverWrap/i.test(b.parentNode.className)?"i"===d&&b.style.backgroundImage&&!/tickerFullPhoto/i.test(b.parentNode.className)?(e=b.style.backgroundImage.replace(/^\s*url\(([^\)]+)\).*$/i,"$1").replace(/(^['"])|(['"]$)/g,""),f=b._title||(b.parentNode&&b.parentNode.title&&b.parentNode.title.length>0?b.parentNode.title:"")||(b.parentNode&&b.parentNode.parentNode&&b.parentNode.parentNode.title&&b.parentNode.parentNode.title.length>0?b.parentNode.parentNode.title:"")):"a"===d&&b.className.indexOf("album_link")>-1&&b.parentNode.className.indexOf("album_thumb")>-1&&b.parentNode.style.backgroundImage&&(e=b.parentNode.style.backgroundImage.replace(/^\s*url\(([^\)]+)\).*$/i,"$1").replace(/(^['"])|(['"]$)/g,""),f=""):(e=b.src.replace(/(^['"])|(['"]$)/g,""),/find\s+friends/i.test(document.title)&&"img"===d&&b.className.indexOf("friendBrowserPicture")>-1&&b.style.backgroundImage&&(e=b.style.backgroundImage.replace(/^\s*url\(([^\)]+)\).*$/i,"$1").replace(/(^['"])|(['"]$)/g,"")),h=a.getComputedStyle(b),(b.naturalWidth-200>parseInt(h.width,10)||b.naturalHeight-200>parseInt(h.height,10))&&(g=e))),e?{src:e,title:f,zoomed:g}:null},onMouseMove:function(a){var c,d,e,f;c=this,a=a||c._lastMouseMoveEvent,a&&(c._lastMouseMoveEvent=a,c.mouseDown?(Math.abs(a.x-c.mouseDownCoords.x)>5||Math.abs(a.y-c.mouseDownCoords.y)>5)&&c.hide():(d=+new Date,d>c._lastMouseMove+c.options.moveDelay&&(c._lastMouseMove=d,e=c.getZoomableTarget(b.getEventTarget(a)),e&&(f=e.zoomed||c.getZoomedPath(e.src)),!c.options.enabled&&c.overrideZoom===!0||c.options.enabled&&c.overrideHide!==!0?!f||c.current&&c.current.src===e.src||/\/vthumb/i.test(e.src)?f||c.hide():c.show({zoomed:f,src:e.src,title:e.title}):c.hide())))},onKeyDown:function(a){var b,d;b=this,d=String(a.keyCode),"17"===d?b._ctrlDown=!0:"16"===d&&(b._shiftDown=!0),d===String(b.options.enableShortcut)&&b._ctrlDown&&b._shiftDown&&b.toggle(),d===String(b.options.openShortcut)&&b._ctrlDown&&b._shiftDown&&c.openImage(),d===String(b.options.forceZoomKey)&&(b.overrideZoom=!0,b.onMouseMove()),d===String(b.options.forceHideKey)&&(b.overrideHide=!0,b.onMouseMove())},onKeyUp:function(a){var b,c;b=this,c=String(a.keyCode),"17"===c?b._ctrlDown=!1:"16"===c&&(b._shiftDown=!1),c===String(b.options.forceZoomKey)&&(b.overrideZoom=!1,b.onMouseMove()),c===String(b.options.forceHideKey)&&(b.overrideHide=!1,b.onMouseMove())},onMouseDrag:function(){this.hide()},onMouseDown:function(a){this.mouseDown=!0,this.mouseDownCoords={x:a.x,y:a.y}},onMouseUp:function(){this.mouseDown=!1,this.mouseDownCoords=null},onBodyClick:function(){this.hide()},createAppIcon:function(){var a;if(a=this,!a.elements.icon){a.elements.icon=b.createElement("span",{"class":a._uid+"-icon",onclick:function(a){return b.preventEventDefault(a),!1}}),a.elements.iconImage=b.createElement("i",{styles:{"background-image":"url("+a.icons[a.options.enabled?"on":"off"]+")"}}),a.elements.iconTooltip=b.createElement("strong",{text:a.name});var d=b.createElement("div",{"class":a._uid+"-titletip"});d.appendChild(a.elements.iconTooltip),a.elements.icon.appendChild(a.elements.iconImage),a.elements.icon.appendChild(d)}if(document.body&&!document.querySelector(a._uid+"-icon")){a._attachIconAttempts=void 0===a._attachIconAttempts?0:a._attachIconAttempts+1;var e=document.querySelector(".fbDockWrapper");!e&&a._attachIconAttempts>5&&(c.log("error","Couldn't attach PZ4FB icon to side bar.",{attempts:a._attachIconAttempts}),e=document.body),e?(e.appendChild(a.elements.icon),a.elements.icon.addEventListener("click",function(c){return b.preventEventDefault(c),a.toggle(),!1}),a.updateAppIcon()):setTimeout(a.createAppIcon.bind(a),500)}return a},updateAppIcon:function(){var a;return a=this,a.elements&&a.elements.icon&&(b.setStyles(a.elements.iconImage,{"background-image":"url("+a.icons[a.options.enabled?"on":"off"]+")"}),b.setProperty(a.elements.iconTooltip,"text",a.name+(a.options.enabled?" (on)":" (off)"))),a}}}(this),function(a){"use strict";var b,c=a.util,d=a.proxy;c.onLoad(function(){d.getExtDetails(function(e){d.storage.get(["enabled","enableShortcut","forceZoomKey","forceHideKey","delay","fadeInDuration","fadeOutDuration","debug"],function(d){b=a.photozoom=new PhotoZoom(c.merge({},e||{},d||{}))})})}),d.storage.addListener(function(a){var c,d={};for(c in a)a.hasOwnProperty(c)&&(d[c]=a[c].newValue);b&&(b.setOptions(d),b.phototip&&b.phototip.setOptions(d))})}(this);